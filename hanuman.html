<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- JWPlayer -->
  <script src="https://ssl.p.jwpcdn.com/player/v/8.32.0/jwplayer.js"></script>
  <!-- hls.js -->
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <script>
    jwplayer.key = 'cLGMn8T20tGvW+0eXPhq4NNmLB57TrscPjd1IyJF84o=';
  </script>

  <style>
    body { margin: 0; overflow: hidden; }
    #player { width: 100%; height: 100%; background-color: #000; }
  </style>
</head>
<body>
  <div id="player"></div>

  <script>
    const videoName = "aay.m3u8"; // Your video
    const workerUrl = "https://m.vinodyadavpothabattula666.workers.dev";

    var jwp = jwplayer('player');

    // Initialize player with a temporary placeholder
    jwp.setup({
      aspectratio: "16:9",
      width: "100%",
      height: "100%",
      sources: [{ file: "about:blank", type: "hls" }], // temporary placeholder
      primary: "html5",
      preload: "auto",
      controls: true
    });

    // Fetch signed URL from Cloudflare Worker
    async function getSignedUrl(name) {
      try {
        const res = await fetch(`${workerUrl}/generate-signed-url?video=/pay/${name}`);
        const data = await res.json();
        return data.url;
      } catch (err) {
        console.error("Failed to get signed URL:", err);
        return null;
      }
    }

    // Load the signed URL
    (async () => {
      const signedUrl = await getSignedUrl(videoName);
      if (!signedUrl) {
        console.error("No signed URL available.");
        return;
      }

      // Load signed URL into player
      jwp.load([{ file: signedUrl, type: "hls", default: true }]);
      jwp.play();
    })();

    // Optional: hls.js fallback
    if (typeof Hls !== "undefined") {
      if (Hls.isSupported()) console.log("✅ hls.js supported");
      else console.log("ℹ️ Using native HLS (Safari/iPhone)");
    }
  </script>
</body>
</html>
