<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TV Friendly JWPlayer</title>

<script src="https://ssl.p.jwpcdn.com/player/v/8.32.0/jwplayer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
  jwplayer.key = 'cLGMn8T20tGvW+0eXPhq4NNmLB57TrscPjd1IyJF84o=';
</script>

<style>
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background-color: #000;
    overflow: hidden;
  }

  #player {
    width: 100%;
    height: 100%;
    background-color: #000;
  }

  /* JWPlayer Custom Styles */
  .jw-title-primary {
    font-weight: bold;
    font-size: 1.5em;
    color: #ff6347 !important;
  }

  .jwplayer .jw-progress {
    background-color: #06b6d4 !important;
  }

  .jwplayer .jw-text-time {
    color: #ff6347 !important;
  }

  .jwplayer .jw-button:hover {
    background: #ff6347 !important;
  }

  .jw-rightclick .jw-reset {
    display: none;
  }

  /* Focus outline for TV remote navigation */
  .tv-focused {
    outline: 3px solid #ff6347 !important;
    outline-offset: 2px;
  }
</style>
</head>

<body>
<div id="player"></div>

<script>
  const jwp = jwplayer('player');
  const pageUrl = window.location.href;
  const playbackKey = `jwplayer-playback-position-${pageUrl}`;
  const savedPosition = localStorage.getItem(playbackKey);

  // JWPlayer Setup
  jwp.setup({
    aspectratio: "16:9",
    width: "100%",
    height: "100%",
    sources: [{
      file: "https://pothabattulavinod.github.io/pay/og.m3u8",
      type: "hls",
      default: true
    }],
    primary: "html5",
    preload: "auto",
    hlshtml: true,
    html5: {
      hlsjsConfig: {
        liveSyncDuration: 3,
        maxBufferLength: 30
      }
    },
    abr: { enabled: true },
    cast: { enabled: true },
    controls: true,
    displayPlaybackLabel: false,
    liveTimeout: 2,
    dvrSeekLimit: 60,
    dvrWindow: 3600,
    tracks: [{
      file: "https://raw.githubusercontent.com/pothabattulavinod/wp/refs/heads/main/og.vtt",
      label: "English",
      kind: "captions",
      "default": true,
      language: "en"
    }],
    fullscreen: { enabled: true },
  });

  // Seek to saved position
  jwp.on('ready', () => {
    if (savedPosition && !isNaN(savedPosition)) {
      jwp.seek(parseFloat(savedPosition));
    }

    const playerContainer = document.querySelector('#player');

    // --- Rewind/Forward Buttons ---
    function addTVButton(iconClass, ariaLabel, seekSeconds) {
      const button = document.createElement('div');
      button.className = `jw-icon-rewind tv-button`;
      button.style.transform = seekSeconds > 0 ? 'scaleX(-1)' : 'none';
      button.setAttribute('aria-label', ariaLabel);
      button.tabIndex = 0;
      button.onclick = () => jwp.seek(jwp.getPosition() + seekSeconds);
      button.onkeydown = e => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          jwp.seek(jwp.getPosition() + seekSeconds);
        }
      };
      playerContainer.appendChild(button);
      return button;
    }

    addTVButton('jw-icon-rewind', 'Rewind 10 seconds', -10);
    addTVButton('jw-icon-rewind', 'Forward 10 seconds', 10);

    // --- TV Focus/Keyboard Navigation ---
    let focusable = Array.from(playerContainer.querySelectorAll('.tv-button, .jw-controlbar .jw-button'));
    let focusIndex = 0;
    focusable[focusIndex].classList.add('tv-focused');

    function updateFocus(newIndex) {
      focusable[focusIndex].classList.remove('tv-focused');
      focusIndex = newIndex;
      if (focusIndex < 0) focusIndex = focusable.length - 1;
      if (focusIndex >= focusable.length) focusIndex = 0;
      focusable[focusIndex].classList.add('tv-focused');
    }

    document.addEventListener('keydown', e => {
      switch (e.key) {
        case 'ArrowRight': updateFocus(focusIndex + 1); break;
        case 'ArrowLeft': updateFocus(focusIndex - 1); break;
        case 'Enter':
        case ' ':
          focusable[focusIndex].click();
          break;
      }
    });
  });

  // Save playback position
  jwp.on('time', event => {
    localStorage.setItem(playbackKey, event.position);
  });

  // Clear on complete
  jwp.on('complete', () => {
    localStorage.removeItem(playbackKey);
  });

  // hls.js fallback
  if (typeof Hls !== "undefined") {
    if (Hls.isSupported()) {
      console.log("✅ hls.js supported");
    } else {
      console.log("ℹ️ Native HLS fallback");
    }
  } else {
    console.log("⚠️ hls.js not loaded");
  }
</script>
</body>
</html>
